def build_story_system_prompt():
    prompt = (
        "你是一个互动小说创作助手，专注于为玩家创作中国当代官场小说。\n"
        "你的任务是根据玩家的输入和历史剧情概要，生成故事的下一段内容。\n"
        "请确保叙事风格一致，剧情逻辑连贯，并且每章长度必须≥2000。\n"
        "如果需要提供选项，请在故事中自然引入，并确保选项之间有明显差异。\n"
        "输出格式必须为 JSON：\n"
        "```\n"
        "{\"story_chunk\": \"<生成的故事内容>\",\
            \"options\": [\"A:<选项A内容>\", \"B:<选项B内容>\", \"C:<选项C内容>\"],\
            \"word_count\": <章节字数>\n\
        }\n"
        "```\n"
    )
    return prompt


def build_story_continuation_prompt(history_summaries, last_story_chunk, user_input):
    prompt = "你正在为玩家创作一部中篇小说，风格为中国当代官小说，模仿《侯卫东官场笔记》或者《人民的名义》。\n\n"
    # prompt += "故事背景在2010年的中国，要人物是一个刚进入国企工作的年轻人。他一步步成长为公司的领导，并在中年步入政坛，成为当代政坛的新星。\n"
    prompt += "故事背景在2010年的中国，展示中国当代政坛的波诡云谲和同样的精彩纷呈。\n\n"
    # prompt += "小说为写实风格（像《人民的名义》），故事围绕个人成长，职场斗争和政治博弈展开。\n\n"
    prompt += "小说为写实风格，故事围绕职场斗争和政治博弈展开。\n\n"
    # prompt += "小说以第三人称有限视角讲述，玩家控制主人公。每次输出一章，每章故事的发展由玩家的回答决定。一些情节中你可以给出选项让玩家选择剧情发展，在另一些情节中也可以让玩家输入别的内容，以对话的方式推动剧情发展。\n\n"
    prompt += "每次输出一章，每章故事的发展由玩家的回答决定。一些情节中你可以给出选项让玩家选择剧情发展，在另一些情节中也可以让玩家输入别的内容，以对话的方式推动剧情发展。\n\n"
    prompt += "以下是玩家的历史剧情概要：\n"
    for summary in history_summaries:
        prompt += f"- {summary}\n"
    prompt += f"\n当前故事片段是：\n{last_story_chunk}\n"
    prompt += f"\n玩家的最新输入是：\n{user_input}\n"
    prompt += (
        "请基于上述历史剧情和玩家输入，继续生成故事下一段内容。\n"
        "要求：\n"
        # "- 保持叙事风格一致\n"
        # "- 保持剧情逻辑连贯\n"
        "- !!!每章长度必须≥2000字，根据剧情需要尽量丰富\n"
        "- 在输出的json中统计章节字数，用以校验\n"
        # "- 请勿直接复述历史概要\n"
        # "- 如果需要提供选项，请在故事中自然引入\n"
        # "- 请注意，选项之间要有明显差异，且每个选项都能引导不同的剧情发展方向。\n"
        "- !!!必须以JSON方式输出:\n"
        "```\n"
        "{\"story_chunk\": \"<生成的故事内容>\",\
            \"options\": [\"A:<选项A内容>\", \"B:<选项B内容>\", \"C:<选项C内容>\"],\
            \"word_count\": <章节字数>\n\
        }\n"
        "```\n"
    )
    return prompt

# def build_generate_options_prompt(latest_chunk):
#     prompt = (
#         "你正在创作一部互动小说，风格为犯罪/悬疑（Suspense / Crime）。\n\n"
#         f"当前故事发展到：\n{latest_chunk}\n\n"
#         "请为玩家提供 3 个剧情选项，供玩家选择下一步行动。要求：\n"
#         "- 每个选项简短清晰（不超过 20 字）\n"
#         "- 每个选项引导不同的剧情方向\n"
#         "- 选项之间差异显著\n"
#         "- 请用字母编号\n"
#         "示例格式：\n"
#         "```\n"
#         "A. 选项1内容\n"
#         "B. 选项2内容\n"
#         "C. 选项3内容\n"
#         "```\n"
#     )
#     return prompt


def build_summary_system_prompt():
    prompt = (
        "你是一个故事概要生成助手，专注于将长篇故事片段压缩成简洁的剧情概要。\n"
        "你的任务是根据提供的故事片段，生成每个故事的核心情节和人物关系的简洁总结。\n"
        "每条总结必须包括时间、地点、主要人物和关键事件，并且每条不超过50字。\n"
        "输出格式必须为 JSON：\n"
        "{\"summary\": [\"<第一条总结>\", \"<第二条总结>\", ...]}\n"
    )
    return prompt


def build_summary_prompt(chunk):
    prompt = (
        "请将以下故事片段压缩成几条 50 字以内的简洁剧情概要，用于记忆存储\n"
        f"```\n{chunk}\n```"
        "\n要求：\n"
        "- 包括时间、地点、主要人物和关键事件\n"
        "- 保持故事的核心情节和人物关系\n"
        "- 用简洁的语言表达\n"
        "- 每个故事清晰总结成一条概括\n"
        "- 每条不超过 50 字\n"
        "- 只保留关键情节\n"
        "- !!!必须以格式示例(JSON)：\n"
        "{\"summary\": [\"2010年9月1日，周正阳在北京东三环的华荣集团报到，成为一名文书。\",\
              \"2010年9月1日，周正阳报道的第二天，集团总经理落马。\"]}\n"
    )
    return prompt
